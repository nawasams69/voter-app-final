import streamlit as st
from supabase import create_client

# --- ржкрзЗржЬ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ---
st.set_page_config(page_title="ржнрзЛржЯрж╛рж░ ржЕржирзБрж╕ржирзНржзрж╛ржи", page_icon="ЁЯЧ│я╕П", layout="centered")

# --- ржХрж╛рж╕рзНржЯржо CSS ---
st.markdown("""
    <style>
    .stButton button { width: 100%; }
    .result-name { font-size: 18px; font-weight: bold; color: #0d6efd; }
    .detail-row { border-bottom: 1px solid #eee; padding: 5px 0; display: flex; justify-content: space-between; }
    .detail-label { font-weight: bold; color: #555; }
    </style>
""", unsafe_allow_html=True)

# --- рж▓рзЛржХрзЗрж╢ржи ржбрж╛ржЯрж╛ ржорзНржпрж╛ржкрж┐ржВ (ржЖржкржирж╛рж░ ржжрзЗржУрзЯрж╛ рж▓ржЬрж┐ржХ ржЕржирзБржпрж╛рзЯрзА) ---
LOCATION_DATA = {
    "ржЪржЯрзНржЯржЧрзНрж░рж╛ржо рж╕рж┐ржЯрж┐ ржХрж░рзНржкрзЛрж░рзЗрж╢ржи": {
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзй (ржмрж╛ржпрж╝ржЬрж┐ржж ржмрзЛрж╕рзНрждрж╛ржорзА)": [
            "ржУржпрж╝рж╛ржЬрзЗржжрж┐ржпрж╝рж╛", "ржирж╛ржержкрзБрж░", "ржнрзЛрж▓рж╛ржЧржЮрзНржЬ", "рж╣рж░рж┐ржкрзБрж░", "ржирзЗржЬрж╛ржорзЗрж╣рж╛ржоржЬрж╛", "ржорж┐ржпрж╝рж╛ржиржЧрж░", "ржШрж╛ржЯржШрж░", 
            "ржкрзВрж░рзНржм рж╢рж╣рзАржжржиржЧрж░", "ржкрж╢рзНржЪрж┐ржо рж╢рж╣рзАржжржиржЧрж░", "ржЫрж╛рж▓рзЗрж╣ржиржЧрж░", "ржЖржорж┐ржиржиржЧрж░", "рж╣рж╛ржЬрзАрж░ржкрзБрж▓", "рж╣рж╛ржорж┐ржжржкрзБрж░", 
            "ржЦрзЛржирзНржжржХрж╛рж░рж╛ржмрж╛ржж", "рж╣рж╛ржЬрзАржкрж╛ржбрж╝рж╛", "ржЙрждрзНрждрж░ ржорзБрж░рж╛ржжржиржЧрж░", "ржжржХрзНрж╖рж┐ржг ржорзБрж░рж╛ржжржиржЧрж░", "ржлржХрж┐рж░рж╛ржмрж╛ржж", "ржнржХрзНрждржкрзБрж░", 
            "ржкрж╛ржарж╛ржиржкрзБрж░", "ржХржХрж╕рзБржиржЧрж░", "рж╕рзЛржирж╛ржкрзБрж░", "ржХрж░рж┐ржоржЧржЮрзНржЬ", "ржЬрж╛ржиржЖрж▓рзА ржиржЧрж░", "ржиржЬрзАрж░рж╛ржмрж╛ржж", "ржорзАрж░ржкрзБрж░", 
            "ржХрж╛ржорж░рж╛ржмрж╛ржж", "рж╕рж╛ржорж╛ржжржкрзБрж░", "ржЬрж╛рж╣рж╛ржиржкрзБрж░"
        ],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзк (ржЪрж╛ржБржжржЧрж╛ржУ)": [
            "ржЕржжрзБрж░ ржкрж╛ржбрж╝рж╛", "ржЙрждрзНрждрж░ ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржмрзЗржкрж╛рж░рзА ржкрж╛ржбрж╝рж╛", "ржЙрждрзНрждрж░ ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржЪрзМржзрзБрж░рзА ржкрж╛ржбрж╝рж╛", 
            "ржЙрждрзНрждрж░ ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржЪрзМржзрзБрж░рзА ржкрж╛ржбрж╝рж╛ рж╢рж┐рж▓рзНржк ржПрж▓рж╛ржХрж╛", "ржЙрждрзНрждрж░ ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржмржбрж╝рзБржпрж╝рж╛ ржкрж╛ржбрж╝рж╛", "ржУржпрж╝рж╛ржкржжрж╛ ржХрж▓рзЛржирзА", 
            "ржХрзЛржжрж╛рж▓ржХрж╛ржЯрж╛", "ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржЖржмрж╛рж╕рж┐ржХ ржПрж▓рж╛ржХрж╛", "ржЪрж╛ржирзНржжржЧрж╛ржБржУ ржЖржмрж╛рж╕рж┐ржХ ржПрж▓рж╛ржХрж╛ ржмрзНрж▓ржХ-ржП", "ржбрж╛рж▓рж┐ ржкрж╛ржбрж╝рж╛", 
            "ржЦрж▓рж┐ржлрж╛ржкрж╛ржбрж╝рж╛ ржУ ржжржХрзНрж╖рж┐ржг ржЪрж╛ржирзНржжржЧрж╛ржБржУ", "ржжржХрзНрж╖рж┐ржг ржкрж╢рзНржЪрж┐ржо ржЪрж╛ржирзНржжржЧрж╛ржБржУ рж╢рж╣рзАржж ржкрж╛ржбрж╝рж╛", "ржирж╛рже ржкрж╛ржбрж╝рж╛", 
            "ржирзВрж░рзБрж▓ рж╣ржХ ржХржирзНржЯрзНрж░рж╛ржХржЯрж░ ржмрж╛ржбрж╝рзА", "ржкрж╛ржарж╛ржирж┐ржпрж╝рж╛ ржЧрзЛржжрж╛", "ржлрж░рж┐ржжрзЗрж░ ржкрж╛ржбрж╝рж╛", "ржорж╛ржЗржЬ ржкрж╛ржбрж╝рж╛", "ржорзМрж▓ржнрзА ржкрж╛ржбрж╝рж╛", 
            "рж╢ржорж╕рзЗрж░ ржкрж╛ржбрж╝рж╛", "рж╣рж╛ржорж┐ржж ржЪрж░", "рж╣рж╛ржпрж╝ржжрж╛рж░ ржЖрж▓рзА ржиржЬрзАрж░ ржмрж╛ржбрж╝рзА ржУ ржЬрж╛рж▓рж╛рж▓ ржЦрж╛ржи", "ржЙрждрзНрждрж░ ржЪрж╛ржирзНржжржЧрж╛ржБржУ рж╣рж┐ржирзНржжрзБ ржкрж╛ржбрж╝рж╛"
        ],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзл (ржЪрж╛ржБржжржЧрж╛ржУ)": [
            "ржЪрж░ ржорзЛрж╣рж░рж╛ рж╕рж┐ ржмрзНрж▓ржХ", "ржЪрж░ рж░рж╛ржЩрзНржЧрж╛ржорж╛ржЯрж┐ржпрж╝рж╛", "ржорзЛрж╣рж░рж╛ ржП ржмрзНрж▓ржХ", "ржорзЛрж╣рж░рж╛ ржмрж┐ ржмрзНрж▓ржХ", "ржорзЛрж╣рж░рж╛ рж╕рж┐ ржЬрзЗ ржПржо рж╕рж┐ ржПрж▓ ржХрж▓рзЛржирзА"
        ],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзм (ржЪрж╛ржБржжржЧрж╛ржУ)": [
            "ржХрзЗ,ржмрж┐,ржЖржорж╛ржи ржЖрж▓рзА рж░рзЛржб ржмрзНрж▓ржХ-рзз", "ржХрзЗ,ржмрж┐,ржЖржорж╛ржи ржЖрж▓рзА рж░рзЛржб ржмрзНрж▓ржХ-рзи", "ржХрзЗ,ржмрж┐,ржЖржорж╛ржи ржЖрж▓рзА рж░рзЛржб ржмрзНрж▓ржХ-рзй", 
            "ржХрзЗ,ржмрж┐,ржЖржорж╛ржи ржЖрж▓рзА рж░рзЛржб ржмрзНрж▓ржХ-рзк", "ржкрзВрж░рзНржм рж╖рзЛрж▓рж╢рж╣рж░ ржмрзНрж▓ржХ-ржП", "ржкрзВрж░рзНржм рж╖рзЛрж▓рж╢рж╣рж░ ржмрзНрж▓ржХ-ржмрж┐", "ржкрзВрж░рзНржм рж╖рзЛрж▓рж╢рж╣рж░ ржмрзНрж▓ржХ-рж╕рж┐"
        ],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзн (ржкрж╛ржБржЪрж▓рж╛ржЗрж╢)": [
            "ржЖржорж┐ржи ржЕржлрж┐рж╕рж╛рж░рзНрж╕ ржХрж▓рзЛржирзА", "ржЖржорж┐ржи рж▓рзЗржмрж╛рж░ ржХрж▓рзЛржирзА", "ржЖрждрзБрж░рж╛рж░ ржбрж┐ржкрзЛ", "ржЖрж▓рзА ржиржЧрж░", "ржЦрждрж┐ржмрзЗрж░ рж╣рж╛ржЯ", 
            "ржирж╛ржЬрж┐рж░ ржкрж╛ржбрж╝рж╛", "ржорзЛржорзЗржи ржмрж╛ржЧ", "ржмрж╛рж░рзНржорж╛ ржХрж▓рзЛржирзА", "ржмрж┐ржмрж┐рж░ рж╣рж╛ржЯ", "ржорзЛрж╣рж╛ржорзНржоржж ржиржЧрж░", "ржорзЛрж╣рж╛ржорзНржоржж ржкрзБрж░", 
            "рж░рзМржлрж╛ржмрж╛ржж ржХрж▓рзЛржирзА", "рж╢рж╛ржирзНрждрж┐ ржиржЧрж░", "рж╣рж╛ржоржЬрж╛рж░ ржЦрж╛ржБ рж▓рзЗржЗржи", "рж╣рж╛ржоржЬрж╛рж░ ржжрж┐ржШрзАрж░ ржкрж╛ржбрж╝", "рж╣рж╛ржоржЬрж╛рж░ ржмрж╛ржЧ", 
            "рж╣рж╛ржоржЬрж╛рж░ ржмрж╛ржЧ ржХрж▓рзЛржирзА", "рж╣рж┐рж▓ржнрж┐ржЙ", "ржмржи ржЧржмрзЗрж╖ржгрж╛ржЧрж╛рж░"
        ]
    },
    "ржмрзЛржпрж╝рж╛рж▓ржЦрж╛рж▓рзА ржкрзМрж░рж╕ржнрж╛": {
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзз": ["ржкрж╢рзНржЪрж┐ржо ржЦрж┐рждрж╛ржмржЪрж░ (ржЕржВрж╢)", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзи": ["ржХржзрзБрж░ржЦрзАрж▓ (ржкрж╛ржарж╛ржи ржкрж╛ржбрж╝рж╛ ржЕржВрж╢)", "ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзи ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзй": ["ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзй ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзй ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзк": ["ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзл": ["ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзм": ["ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрзВрж░рзНржм ржЧрзЛржоржжржирзНржбрзА (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзн": ["ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзо": ["ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"],
        "ржУржпрж╝рж╛рж░рзНржб ржиржВ-рзжрзп": ["ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзп ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзз)", "ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА (рзп ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢-рзи)"]
    },
    "ржЗржЙржирж┐ржпрж╝ржи ржкрж░рж┐рж╖ржж (ржмрзЛржпрж╝рж╛рж▓ржЦрж╛рж▓рзА)": {
        "ржХржзрзБрж░ржЦрзАрж▓ ржЗржЙржирж┐ржпрж╝ржи": ["ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзз ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзи ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзй ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб", "ржХржзрзБрж░ржЦрзАрж▓ (ржЕржВрж╢) рзп ржиржВ ржУржпрж╝рж╛рж░рзНржб"],
        "ржкрж╢рзНржЪрж┐ржо ржЧрзЛржоржжржирзНржбрзА ржЗржЙржирж┐ржпрж╝ржи": ["ржЪрж░ржЦрж┐ржЬрж┐рж░ржкрзБрж░", "ржЪрж░ржЦрж┐ржЬрж┐рж░ржкрзБрж░ (ржкрзВрж░рзНржм)", "ржжржХрзНрж╖рж┐ржи ржЪрж░ржЦрж┐ржЬрж┐рж░ржкрзБрж░"],
        "рж╢рж╛ржХржкрзБрж░рж╛ ржЗржЙржирж┐ржпрж╝ржи": ["ржкрж╢рзНржЪрж┐ржо рж╢рж╛ржХржкрзБрж░рж╛ (ржЙрждрзНрждрж░ ржкрж╢рзНржЪрж┐ржорж╛ржВрж╢)", "ржкрж╢рзНржЪрж┐ржо рж╢рж╛ржХржкрзБрж░рж╛ (рзи ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржкрж╢рзНржЪрж┐ржо рж╢рж╛ржХржкрзБрж░рж╛ (ржжржХрзНрж╖рж┐ржгрж╛ржВрж╢)", "ржкрж╢рзНржЪрж┐ржо рж╢рж╛ржХржкрзБрж░рж╛ (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржоржзрзНржпржо рж╢рж╛ржХржкрзБрж░рж╛ (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржоржзрзНржпржо рж╢рж╛ржХржкрзБрж░рж╛ (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржоржзрзНржпржо рж╢рж╛ржХржкрзБрж░рж╛ (ржЙрждрзНрждрж░рж╛ржВрж╢)", "ржкрзВрж░рзНржм рж╢рж╛ржХржкрзБрж░рж╛", "ржШрзЛрж╖ржЦрзАрж▓ (ржоржзрзНржпржо рж╢рж╛ржХржкрзБрж░рж╛ ржкрзВрж░рзНржмрж╛ржВрж╢)"],
        "рж╕рж╛рж░рзЛржпрж╝рж╛рждрж▓рзА ржЗржЙржирж┐ржпрж╝ржи": ["ржкрзВрж░рзНржм рж╕рж░рзЛржпрж╝рж╛рждрж▓рзА ржУ ржЫржиржжржирзНржбрзА (ржкрзВрж░рзНржмрж╛ржВрж╢)", "ржкрж╢рзНржЪрж┐ржо рж╕рж░рзЛржпрж╝рж╛рждрж▓рзА ржЫржиржжржирзНржбрзА (ржкрж╢рзНржЪрж┐ржорж╛ржВрж╢)", "ржмрзЗржВржЧрзБрж░рж╛", "рж╣рзЛрж░рж╛рж░ржмрж╛ржЧ", "ржкрж╢рзНржЪрж┐ржо ржЦрж┐рждрж╛ржмржЪрж░", "ржкрзВрж░рзНржм ржЦрж┐рждрж╛ржмржЪрж░", "ржЗржорж╛ржорзБрж▓рзНрж▓рж╛рж░ржЪрж░", "ржжржХрзНрж╖рж┐ржг рж╕рж╛рж░рзЛржпрж╝рж╛рждрж▓рзА", "ржЙрждрзНрждрж░ рж╕рж╛рж░рзЛржпрж╝рж╛рждрж▓рзА"],
        "ржкрзЛржкрж╛ржжрж┐ржпрж╝рж╛ ржЗржЙржирж┐ржпрж╝ржи": ["рж╕рзИржпрж╝ржжржкрзБрж░", "ржЙрждрзНрждрж░ ржЖржХрзБржмржжржирзНржбрзА", "ржжржХрзНрж╖рж┐ржг ржЖржХрзБржмржжржирзНржбрзА", "ржкрзЛржкрж╛ржжрж┐ржпрж╝рж╛ (ржжржХрзНрж╖рж┐ржгрж╛ржВрж╢)", "ржкрзЛржкрж╛ржжрж┐ржпрж╝рж╛ (ржЙрждрзНрждрж░рж╛ржВрж╢)", "ржкрзЛржкрж╛ржжрж┐ржпрж╝рж╛ (ржЕржВрж╢) (ржкрж╢рзНржЪрж┐ржорж╛ржВрж╢)", "ржЖржХрж╛рж▓рж┐ржпрж╝", "ржкрзЛржкрж╛ржжрж┐ржпрж╝рж╛", "ржмрж┐ржжрзБржЧрзНрж░рж╛ржо (ржкрж╢рзНржЪрж┐ржорж╛ржВрж╢)", "ржмрж┐ржжрзБржЧрзНрж░рж╛ржо (ржкрзВрж░рзНржмрж╛ржВрж╢)"],
        "ржЪрж░ржиржжрзНржмрзАржк ржЗржЙржирж┐ржпрж╝ржи": ["ржЪрж░ржиржжрзНржмрзАржк (рзз ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржкрж╢рзНржЪрж┐ржо ржЪрж░ржиржжрзНржмрзАржк", "ржкрж╛ржарж╛ржиржкрж╛ржбрж╝рж╛ (рзй ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржмрж╛рж░рзИржкрж╛ржбрж╝рж╛ (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржмрж╛рж░рзИржкрж╛ржбрж╝рж╛ (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржмрж╛рж░рзИржкрж╛ржбрж╝рж╛ (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЪрж░ржиржжрзНржмрзАржк (рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЪрж░ржиржжрзНржмрзАржк (рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржкрзВрж░рзНржм ржЪрж░ржиржжрзНржмрзАржк"],
        "рж╢рзНрж░рзАржкрзБрж░-ржЦрж░ржиржжрзНржмрзАржк ржЗржЙржирж┐ржпрж╝ржи": ["ржкрж╢рзНржЪрж┐ржо ржЦрж░ржиржжрзНржмрзАржк", "ржЦрж░ржиржжрзНржмрзАржк ржорж╛ржзрзНржпржо", "ржЦрж░ржиржжрзНржмрзАржк", "рж╢рзНрж░рзАржкрзБрж░ (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "рж╢рзНрж░рзАржкрзБрж░ (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "рж╢рзНрж░рзАржкрзБрж░ (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЬрзИрж╖рзНржЯрзНржпржкрзБрж░рж╛ (рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЬрзИрж╖рзНржЯрзНржпржкрзБрж░рж╛ (рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЬрзИрж╖рзНржЯрзНржпржкрзБрж░рж╛ (рзп ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)"],
        "ржЖржорзБржЪрж┐ржпрж╝рж╛ ржЗржЙржирж┐ржпрж╝ржи": ["ржХрж╛ржирзБржиржЧрзЛржкрж╛ржбрж╝рж╛", "ржХрж╛ржирзБржиржЧрзЛржкрж╛ржбрж╝рж╛/ржмржЧрж╛ржЪржбрж╝рж╛", "ржЖржорзБржЪрж┐ржпрж╝рж╛", "ржзрзЛрж░рж▓рж╛ (рзк ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржзрзЛрж░рж▓рж╛ (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржкрзВрж░рзНржм ржзрзЛрж░рж▓рж╛/ржХрж╛ржирзБржиржЧрзЛржкрж╛ржбрж╝рж╛", "ржзрзЛрж░рж▓рж╛ (рзн ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржзрзЛрж░рж▓рж╛ (рзо ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржкрзВрж░рзНржм ржзрзЛрж░рж▓рж╛"],
        "ржЖрж╣рж▓рзНрж▓рж╛ ржХрж░рж▓ржбрзЗржВржЧрж╛ ржЗржЙржирж┐ржпрж╝ржи": ["ржЙрждрзНрждрж░ ржХрж░рж▓ржбрзЗржВржЧрж╛", "ржоржзрзНржпржо ржХрж░рж▓ржбрзЗржВржЧрж╛", "ржжржХрзНрж╖рж┐ржг ржХрж░рж▓ржбрзЗржВржЧрж╛", "ржжржХрзНрж╖рж┐ржг ржЙрждрзНрждрж░ ржнрзВрж░рзНрж╖рж┐", "ржЙрждрзНрждрж░ ржнрзВрж░рзНрж╖рж┐ (рзл ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЙрждрзНрждрж░ ржнрзВрж░рзНрж╖рж┐ (рзм ржиржВ ржУржпрж╝рж╛рж░рзНржб ржЕржВрж╢)", "ржЖрж╣рж▓рзНрж▓рж╛ рж╕рж╛ржзрж╛рж░ржкрж╛ржбрж╝рж╛", "ржЖрж╣рж▓рзНрж▓рж╛ рж╢рзЗржЦ ржЪрзМржзрзБрж░рзА ржкрж╛ржбрж╝рж╛", "ржЖрж╣рж▓рзНрж▓рж╛ рж╢рзЗржЦ ржЪрзМржзрзБрж░рзА ржкрж╛ржбрж╝рж╛ (ржжржХрзНрж╖рж┐ржи)"]
    }
}

# --- ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрж╢ржи ---
@st.cache_resource
def init_connection():
    try:
        return create_client(st.secrets["SUPABASE_URL"], st.secrets["SUPABASE_KEY"])
    except:
        st.error("Supabase Secrets ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐!")
        st.stop()

supabase = init_connection()

# --- ржкржк-ржЖржк ржлрж╛ржВрж╢ржи ---
@st.dialog("ржнрзЛржЯрж╛рж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржп")
def show_details(voter):
    details = {
        "ржирж╛ржо": voter.get('name'),
        "рж╕рж┐рж░рж┐ржпрж╝рж╛рж▓ ржиржВ": voter.get('serial_no'),
        "ржнрзЛржЯрж╛рж░ ржиржВ": voter.get('voter_no'),
        "рж▓рж┐ржЩрзНржЧ": voter.get('gender'),
        "ржкрж┐рждрж╛": voter.get('father'),
        "ржорж╛рждрж╛": voter.get('mother'),
        "ржкрзЗрж╢рж╛": voter.get('profession'),
        "ржЬржирзНржо рждрж╛рж░рж┐ржЦ": voter.get('dob'),
        "ржарж┐ржХрж╛ржирж╛": voter.get('address'),
        "ржнрзЛржЯрж╛рж░ ржПрж▓рж╛ржХрж╛": f"{voter.get('voter_area_name')} ({voter.get('area_code')})",
        "ржЬрзЗрж▓рж╛": voter.get('district'),
        "ржЙржкржЬрзЗрж▓рж╛/ржерж╛ржирж╛": voter.get('upazila'),
        "рж╕рж┐ржЯрж┐ ржХрж░рзНржкрзЛрж░рзЗрж╢ржи": voter.get('city_corp'),
        "ржУржпрж╝рж╛рж░рзНржб (ржЗржЙржирж┐ржпрж╝ржи)": voter.get('ward_union'),
        "ржЗржЙржирж┐ржпрж╝ржи/ржУржпрж╝рж╛рж░рзНржб": voter.get('union_ward'),
        "ржкрзЛрж╕рзНржЯ ржЕржлрж┐рж╕": voter.get('post_office'),
        "ржкрзЛрж╕рзНржЯржХрзЛржб": voter.get('postcode'),
        "ржЕржЮрзНржЪрж▓": voter.get('region'),
        "ржнрзЛржЯржХрзЗржирзНржжрзНрж░": voter.get('polling_center')
    }

    for key, value in details.items():
        st.markdown(f"""
        <div class="detail-row">
            <span class="detail-label">{key}</span>
            <span>{value if value else '-'}</span>
        </div>
        """, unsafe_allow_html=True)

# --- ржорзЗржЗржи UI ---
st.title("ЁЯЧ│я╕П ржнрзЛржЯрж╛рж░ рждржерзНржп ржпрж╛ржЪрж╛ржЗржХрж░ржг")

# --- ржзрж╛ржк рзз: ржПрж▓рж╛ржХрж╛ ржирж┐рж░рзНржмрж╛ржЪржи (Hierarchy Logic) ---
st.subheader("рзз. ржПрж▓рж╛ржХрж╛ ржирж┐рж░рзНржмрж╛ржЪржи")
col_loc1, col_loc2, col_loc3 = st.columns(3)

with col_loc1:
    # ржкрзНрж░рж╢рзНржи рзз: ржорзЗржЗржи ржХрзНржпрж╛ржЯрж╛ржЧрж░рж┐
    main_cat = st.selectbox("ржкрзНрж░рж╢рж╛рж╕ржирж┐ржХ ржПрж▓рж╛ржХрж╛", list(LOCATION_DATA.keys()))

with col_loc2:
    # ржкрзНрж░рж╢рзНржи рзи: рж╕рж╛ржм-ржХрзНржпрж╛ржЯрж╛ржЧрж░рж┐ (рззржо ржкрзНрж░рж╢рзНржирзЗрж░ ржУржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ)
    sub_cat_options = list(LOCATION_DATA[main_cat].keys())
    sub_cat = st.selectbox("ржУржпрж╝рж╛рж░рзНржб ржмрж╛ ржЗржЙржирж┐ржпрж╝ржи", sub_cat_options)

with col_loc3:
    # ржкрзНрж░рж╢рзНржи рзй: ржнрзЛржЯрж╛рж░ ржПрж▓рж╛ржХрж╛ (рзирзЯ ржкрзНрж░рж╢рзНржирзЗрж░ ржУржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ)
    # ржПржЯрж┐ржЗ ржЖржорж╛ржжрзЗрж░ ржлрж╛ржЗржирж╛рж▓ рж╕рж╛рж░рзНржЪ ржХрж┐-ржУрзЯрж╛рж░рзНржб (voter_area_name)
    area_options = LOCATION_DATA[main_cat][sub_cat]
    selected_area_name = st.selectbox("ржнрзЛржЯрж╛рж░ ржПрж▓рж╛ржХрж╛ (ржЧрзНрж░рж╛ржо/ржорж╣рж▓рзНрж▓рж╛)", area_options)

# --- ржзрж╛ржк рзи: ржмрзНржпржХрзНрждрж┐ рж╢ржирж╛ржХрзНрждржХрж░ржг ---
st.subheader("рзи. ржмрзНржпржХрзНрждрж┐ рж╢ржирж╛ржХрзНрждржХрж░ржг")
col1, col2 = st.columns(2)
with col1:
    gender = st.selectbox("рж▓рж┐ржЩрзНржЧ (ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ)", ["ржкрзБрж░рзБрж╖", "ржорж╣рж┐рж▓рж╛", "рж╣рж┐ржЬрзЬрж╛"], index=0)
with col2:
    dob = st.text_input("ржЬржирзНржо рждрж╛рж░рж┐ржЦ (ржРржЪрзНржЫрж┐ржХ)", placeholder="DD/MM/YYYY")

col3, col4 = st.columns(2)
with col3:
    name_input = st.text_input("ржирж╛ржо (ржРржЪрзНржЫрж┐ржХ)", placeholder="ржирж╛ржорзЗрж░ ржЕржВрж╢...")
with col4:
    parent_input = st.text_input("ржкрж┐рждрж╛/ржорж╛рждрж╛рж░ ржирж╛ржо (ржРржЪрзНржЫрж┐ржХ)", placeholder="ржирж╛ржорзЗрж░ ржЕржВрж╢...")

search_btn = st.button("ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи", type="primary")

# --- рж▓ржЬрж┐ржХ ---
if search_btn:
    if not selected_area_name:
        st.warning("тЪая╕П ржжрзЯрж╛ ржХрж░рзЗ ржнрзЛржЯрж╛рж░ ржПрж▓рж╛ржХрж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржиред")
    elif not (dob or name_input or parent_input):
        st.error("тЪая╕П рж▓рж┐ржЩрзНржЧрзЗрж░ рж╕рж╛ржерзЗ ржЕржирзНрждржд ржПржХржЯрж┐ рждржерзНржп ржжрж┐рждрзЗ рж╣ржмрзЗ: ржирж╛ржо, ржкрж┐рждрж╛/ржорж╛рждрж╛рж░ ржирж╛ржо ржЕржержмрж╛ ржЬржирзНржо рждрж╛рж░рж┐ржЦред")
    else:
        with st.spinner("рждржерзНржп ржЦрзЛржБржЬрж╛ рж╣ржЪрзНржЫрзЗ..."):
            try:
                # ржХрзБрзЯрзЗрж░рж┐ рждрзИрж░рж┐
                query = supabase.table("Voter").select("*")
                
                # рзз. рж▓рзЛржХрзЗрж╢ржи ржлрж┐рж▓рзНржЯрж╛рж░ (ржирж╛ржо ржжрж┐рзЯрзЗ рж╕рж╛рж░рзНржЪ рж╣ржмрзЗ)
                # ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ 'voter_area_name' ржХрж▓рж╛ржорзЗрж░ рж╕рж╛ржерзЗ ржбрзНрж░ржкржбрж╛ржЙржирзЗрж░ ржирж╛ржо ржорж┐рж▓рж╛ржирзЛ рж╣ржЪрзНржЫрзЗ
                query = query.eq("voter_area_name", selected_area_name) 
                
                # рзи. ржЬрзЗржирзНржбрж╛рж░ ржлрж┐рж▓рзНржЯрж╛рж░ (ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ)
                query = query.eq("gender", gender)

                # рзй. ржЕржкрж╢ржирж╛рж▓ ржлрж┐рж▓рзНржЯрж╛рж░
                if dob:
                    query = query.ilike("dob", f"%{dob}%")
                if name_input:
                    query = query.ilike("name", f"%{name_input}%")
                if parent_input:
                    query = query.or_(f"father.ilike.%{parent_input}%,mother.ilike.%{parent_input}%")

                # рззрзжрзж рж░рзЗржЬрж╛рж▓рзНржЯ рж▓рж┐ржорж┐ржЯ
                response = query.limit(100).execute()
                data = response.data

                if not data:
                    st.error(f"тЭМ '{selected_area_name}' ржПрж▓рж╛ржХрж╛рзЯ ржПржЗ рждржерзНржпрзЗрж░ ржХрзЛржирзЛ ржнрзЛржЯрж╛рж░ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред")
                else:
                    st.success(f"тЬЕ {len(data)} ржЬржи ржнрзЛржЯрж╛рж░ ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗ")
                    
                    for voter in data:
                        with st.container():
                            col_info, col_btn = st.columns([0.7, 0.3])
                            with col_info:
                                st.markdown(f"""
                                <div class="result-name">{voter.get('name', 'ржирж╛ржо ржирзЗржЗ')}</div>
                                <small>ржкрж┐рждрж╛: {voter.get('father', '-')} | ржнрзЛржЯрж╛рж░ ржиржВ: {voter.get('voter_no', '-')}</small>
                                """, unsafe_allow_html=True)
                            with col_btn:
                                if st.button("ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд", key=voter['voter_no']):
                                    show_details(voter)
                            st.divider()

            except Exception as e:
                st.error(f"рж╕рж╛рж░рзНржнрж╛рж░ ржПрж░рж░: {e}")

